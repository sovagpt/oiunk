<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OINK FM 24.7 - AI Crypto Radio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .radio-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 800px;
            width: 90%;
        }

        .logo {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tagline {
            color: #fff;
            font-size: 1.2em;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .visual-container {
            position: relative;
            width: 100%;
            height: 400px;
            margin: 20px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 400px;
            border-radius: 15px;
            overflow: hidden;
            background: #000;
        }

        #streamCanvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .status-display {
            background: rgba(0, 0, 0, 0.7);
            color: #00ff41;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            font-weight: bold;
            text-shadow: 0 0 10px #00ff41;
            border: 2px solid #00ff41;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.stop {
            background: linear-gradient(45deg, #ff4757, #ff3742);
        }

        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
        }

        .config-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .config-section h3 {
            color: #fff;
            margin-bottom: 15px;
        }

        .config-section input, .config-section textarea {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.9);
        }

        .live-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff4757;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            opacity: 0;
            animation: pulse 2s infinite;
        }

        .live-indicator.active {
            opacity: 1;
        }

        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        .news-ticker {
            background: rgba(0, 0, 0, 0.8);
            color: #00ff41;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 100px;
            overflow-y: auto;
        }

        .streaming-section {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff4757;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .streaming-section h3 {
            color: #ff4757;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stream-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ff4757;
            animation: pulse 2s infinite;
        }

        .stream-status.live {
            background: #00ff41;
        }

        .youtube-setup {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="radio-container">
        <div class="logo">OINK FM</div>
        <div class="tagline">24.7 AI Crypto & Memecoin Radio - Hosted by Porky</div>
        
        <div class="visual-container">
            <div class="canvas-container">
                <canvas id="streamCanvas" width="800" height="400"></canvas>
            </div>
            <div class="live-indicator" id="liveIndicator">üî¥ LIVE</div>
        </div>

        <div class="status-display" id="statusDisplay">
            üéôÔ∏è Ready to broadcast... Click Start Show!
        </div>

        <div class="news-ticker" id="newsTicker">
            Latest crypto intel will appear here...
        </div>

        <div class="controls">
            <button class="btn" onclick="startShow()">üéôÔ∏è Start Show</button>
            <button class="btn stop" onclick="stopShow()">‚èπÔ∏è Stop Show</button>
            <button class="btn" onclick="skipToNext()">‚è≠Ô∏è Skip Segment</button>
        </div>

        <audio class="audio-player" id="audioPlayer" controls>
            Your browser does not support the audio element.
        </audio>

        <div class="streaming-section">
            <h3>üì∫ YouTube Live Streaming <span class="stream-status" id="streamStatus"></span></h3>
            <div class="youtube-setup">
                <p><strong>OBS Setup Instructions:</strong></p>
                <ol style="color: #fff; margin-left: 20px;">
                    <li>Download OBS Studio (free)</li>
                    <li>Add Browser Source: <strong>https://sovagpt.github.io/oiunk</strong></li>
                    <li>Set Width: 800, Height: 400</li>
                    <li>Connect OBS to YouTube and go live!</li>
                </ol>
            </div>
        </div>

        <div class="config-section">
            <h3>üéµ Add More Music (Optional)</h3>
            <textarea id="songList" rows="3" placeholder="Add more song URLs (one per line)">
https://www.soundjay.com/misc/sounds/bell-ringing-05.wav
https://file-examples.com/storage/fe86c94f7bb8649b7aa1f39/2017/11/file_example_MP3_700KB.mp3</textarea>
        </div>
    </div>

    <script>
        class OinkFMRadio {
            constructor() {
                this.isPlaying = false;
                this.currentSegment = null;
                this.songs = [
                    'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav',
                    'https://file-examples.com/storage/fe86c94f7bb8649b7aa1f39/2017/11/file_example_MP3_700KB.mp3'
                ];
                this.apiKey = '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';
                
                // Media elements
                this.canvas = document.getElementById('streamCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.currentImage = 'studio';
                
                // Images - Your GitHub URLs
                this.studioImage = new Image();
                this.porkyGif = new Image();
                this.studioImage.src = 'https://raw.githubusercontent.com/sovagpt/oiunk/main/assets/images/studio.jpg';
                this.porkyGif.src = 'https://raw.githubusercontent.com/sovagpt/oiunk/main/assets/images/porky.gif';
                
                // DOM elements
                this.audioPlayer = document.getElementById('audioPlayer');
                this.statusDisplay = document.getElementById('statusDisplay');
                this.newsTicker = document.getElementById('newsTicker');
                this.liveIndicator = document.getElementById('liveIndicator');
                this.streamStatus = document.getElementById('streamStatus');
                
                this.setupEventListeners();
                this.setupCanvas();
            }

            setupCanvas() {
                this.canvas.width = 800;
                this.canvas.height = 400;
                
                // Default background
                this.ctx.fillStyle = '#667eea';
                this.ctx.fillRect(0, 0, 800, 400);
                this.ctx.fillStyle = 'white';
                this.ctx.font = '24px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('OINK FM Studio - Loading...', 400, 200);
                
                // Start animation loop
                this.animate();
            }

            animate() {
                // Clear canvas
                this.ctx.clearRect(0, 0, 800, 400);
                
                // Draw current image
                if (this.currentImage === 'studio' && this.studioImage.complete) {
                    this.ctx.drawImage(this.studioImage, 0, 0, 800, 400);
                } else if (this.currentImage === 'porky' && this.porkyGif.complete) {
                    this.ctx.drawImage(this.porkyGif, 0, 0, 800, 400);
                } else {
                    // Fallback background
                    this.ctx.fillStyle = '#667eea';
                    this.ctx.fillRect(0, 0, 800, 400);
                    this.ctx.fillStyle = 'white';
                    this.ctx.font = '24px Arial';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText('OINK FM Studio', 400, 200);
                }
                
                // Add OINK FM logo overlay when live
                if (this.isPlaying) {
                    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    this.ctx.fillRect(10, 10, 200, 60);
                    this.ctx.fillStyle = '#ff6b6b';
                    this.ctx.font = 'bold 20px Arial';
                    this.ctx.textAlign = 'left';
                    this.ctx.fillText('OINK FM 24.7', 20, 35);
                    this.ctx.fillStyle = '#4ecdc4';
                    this.ctx.font = '14px Arial';
                    this.ctx.fillText('Hosted by Porky', 20, 55);
                }
                
                // Add live crypto ticker at bottom
                if (this.isPlaying && this.newsTicker.textContent !== 'Latest crypto intel will appear here...') {
                    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                    this.ctx.fillRect(0, 360, 800, 40);
                    this.ctx.fillStyle = '#00ff41';
                    this.ctx.font = '16px Courier New';
                    this.ctx.textAlign = 'left';
                    const tickerText = this.newsTicker.textContent.substring(0, 80) + '...';
                    this.ctx.fillText(tickerText, 10, 385);
                }
                
                requestAnimationFrame(() => this.animate());
            }

            setupEventListeners() {
                // Update song list
                document.getElementById('songList').addEventListener('input', (e) => {
                    const newSongs = e.target.value.split('\n').filter(url => url.trim());
                    this.songs = [...this.songs, ...newSongs];
                });
            }

            async fetchCryptoNews() {
                try {
                    this.updateStatus("üì° Fetching latest crypto data...");
                    
                    const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false&price_change_percentage=24h');
                    const data = await response.json();
                    
                    return data.slice(0, 5);
                } catch (error) {
                    console.error('Error fetching crypto data:', error);
                    this.updateNewsTicker("‚ùå Failed to fetch crypto data");
                    return null;
                }
            }

            async generateRadioContent(cryptoData) {
                const prompt = `You are Porky, a charismatic crypto radio host on OINK FM 24.7. 
                Create a short, engaging radio segment (30-60 seconds when spoken) about recent crypto news.
                
                Current crypto data: ${JSON.stringify(cryptoData)}
                
                Style: Casual, enthusiastic, slightly edgy like a pirate radio DJ with pig-themed humor
                Include: Current prices, trending coins, market sentiment, memecoin mentions
                Personality: Fun, irreverent, uses pig puns and crypto slang
                End with: A smooth transition to introduce the next song
                Keep it under 150 words and make it sound natural and spontaneous.`;

                try {
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': this.apiKey,
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: 'claude-3-sonnet-20240229',
                            max_tokens: 200,
                            messages: [{
                                role: 'user',
                                content: prompt
                            }]
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }

                    const data = await response.json();
                    return data.content[0].text;
                } catch (error) {
                    console.error('Error generating content:', error);
                    this.updateStatus("‚ö†Ô∏è API Error - using fallback content");
                    return "Oink oink! Porky here on OINK FM! The crypto markets are absolutely hog wild today - Bitcoin's squealing to new heights, memecoins are rolling in the mud, and the whole space is more chaotic than feeding time at the farm! But hey, that's why we love this pig pen, right? Let's bacon some musical magic while I sniff out more juicy intel for you beautiful degenerates!";
                }
            }

            async textToSpeech(text) {
                return new Promise((resolve) => {
                    if ('speechSynthesis' in window) {
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.rate = 0.9;
                        utterance.pitch = 1.1;
                        utterance.volume = 0.8;
                        
                        const voices = speechSynthesis.getVoices();
                        const preferredVoice = voices.find(voice => 
                            voice.name.includes('Google') || 
                            voice.name.includes('Microsoft') ||
                            voice.lang.includes('en-US')
                        );
                        if (preferredVoice) {
                            utterance.voice = preferredVoice;
                        }
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        speechSynthesis.speak(utterance);
                    } else {
                        setTimeout(resolve, text.length * 50);
                    }
                });
            }

            async startShow() {
                if (this.isPlaying) return;
                
                this.isPlaying = true;
                this.liveIndicator.classList.add('active');
                this.updateStatus("üéôÔ∏è OINK FM is going LIVE!");
                
                // Load additional songs if any
                const songInput = document.getElementById('songList').value;
                const additionalSongs = songInput.split('\n').filter(url => url.trim());
                this.songs = [...this.songs, ...additionalSongs];
                
                while (this.isPlaying) {
                    try {
                        // Fetch crypto data
                        const cryptoData = await this.fetchCryptoNews();
                        
                        if (cryptoData) {
                            // Update news ticker
                            this.updateNewsTicker(cryptoData);
                            
                            // Generate radio content
                            this.updateStatus("ü§ñ Porky is cooking up some hot takes...");
                            const radioScript = await this.generateRadioContent(cryptoData);
                            
                            // Show Porky talking
                            this.showPorkyTalking();
                            this.updateStatus("üéôÔ∏è Porky is dropping knowledge...");
                            
                            // Speak the content
                            await this.textToSpeech(radioScript);
                            
                            // Switch to studio view
                            this.showStudio();
                            this.updateStatus("üéµ Now spinning tracks...");
                            
                            // Play random song
                            await this.playRandomSong();
                        }
                        
                        // Wait before next segment
                        if (this.isPlaying) {
                            await this.delay(10000);
                        }
                        
                    } catch (error) {
                        console.error('Error in show loop:', error);
                        this.updateStatus("‚ùå Something went wrong, retrying...");
                        await this.delay(30000);
                    }
                }
            }

            stop() {
                this.isPlaying = false;
                this.liveIndicator.classList.remove('active');
                this.audioPlayer.pause();
                this.showStudio();
                this.updateStatus("üìª OINK FM is off the air");
                speechSynthesis.cancel();
            }

            skipToNext() {
                if (this.isPlaying) {
                    this.audioPlayer.pause();
                    speechSynthesis.cancel();
                    this.updateStatus("‚è≠Ô∏è Skipping to next segment...");
                }
            }

            showPorkyTalking() {
                this.currentImage = 'porky';
            }

            showStudio() {
                this.currentImage = 'studio';
            }

            updateStatus(message) {
                this.statusDisplay.textContent = message;
                console.log(message);
            }

            updateNewsTicker(data) {
                if (Array.isArray(data)) {
                    const tickerText = data.map(coin => 
                        `${coin.name}: $${coin.current_price.toFixed(2)} (${coin.price_change_percentage_24h > 0 ? '+' : ''}${coin.price_change_percentage_24h.toFixed(1)}%)`
                    ).join(' ‚Ä¢ ');
                    this.newsTicker.textContent = tickerText;
                } else {
                    this.newsTicker.textContent = data;
                }
            }

            async playRandomSong() {
                if (this.songs.length === 0) return;
                
                const randomSong = this.songs[Math.floor(Math.random() * this.songs.length)];
                
                return new Promise((resolve) => {
                    this.audioPlayer.src = randomSong;
                    this.audioPlayer.play().catch(e => {
                        console.error('Error playing song:', e);
                        resolve();
                    });
                    
                    const timeout = setTimeout(resolve, 180000); // Max 3 minutes
                    this.audioPlayer.onended = () => {
                        clearTimeout(timeout);
                        resolve();
                    };
                    this.audioPlayer.onerror = () => {
                        clearTimeout(timeout);
                        resolve();
                    };
                });
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Initialize the radio
        const radio = new OinkFMRadio();

        // Global functions for buttons
        function startShow() {
            radio.startShow();
        }

        function stopShow() {
            radio.stop();
        }

        function skipToNext() {
            radio.skipToNext();
        }

        // Load voices when available
        if ('speechSynthesis' in window) {
            speechSynthesis.onvoiceschanged = () => {
                console.log('Available voices:', speechSynthesis.getVoices().map(v => v.name));
            };
        }
    </script>
</body>
</html>
